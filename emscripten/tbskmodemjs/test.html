<!doctype html>
<html lang=en-us>
<head>
  <meta charset=utf-8>
  <meta content="text/html; charset=utf-8" http-equiv=Content-Type>
  <title>Hello WASM World!</title>
</head>
<body>
    <button class=mybutton>Run mulBy2</button><br>
    <script>
        function sandbox(MOD) {
            let WasmProxy = TBSKmodemJS.WasmProxy;
            let DoubleInputIterator = TBSKmodemJS.DoubleInputIterator;
            let IntOutputIterator = TBSKmodemJS.IntOutputIterator;


        }


        class Listener {
            waitForSignal() { }
            pushSorce() { }
            read() { }
        }






        window.addEventListener('load', function () {            
            Module.onRuntimeInitialized = function () {
                Module._TBSKmodemJS();
                sandbox(Module);

                let tj = TBSKmodemJS;
                var tone = new tj.XPskSinTone(10,10);
                var preamble = new tj.CoffPreamble(tone);
                let mod = new tj.TbskModulator(tone, preamble);
                console.log("pointers:"+tj.getPointerHolderSize());
                let farray = mod.modulate([1, 2, 3]);
                console.log(farray.length);

                console.log(tj);
                let demod = new tj.TbskDemodulator(tone, preamble);
                let dint = demod.demodulate(farray);
                console.log(dint);

//                var actx = new (window.AudioContext || window.webkitAudioContext)();

//                let mod = new Modulator();
 //               let source=mod.modulate2BufferSource(actx,[0,1,2],8000);

                // AudioBufferSourceNode にバッファーを設定する
 //               source.connect(actx.destination);
                // 音源の再生を始める
 //               source.start();
            }








		
		});  
  </script>
  <script async src="wasm_main.js"></script>
</body>
</html>